{"repository_name":"github.com/russ/middleware","body":"[![GitHub release](https://img.shields.io/github/release/russ/middleware.svg)](https://github.com/russ/middleware/releases)\n[![Build Status](https://travis-ci.org/russ/middleware.svg?branch=master)](https://travis-ci.org/russ/middleware)\n\n# Middleware\n\nMiddleware is a library which provides a generalized implementation of the chain of responsibility pattern for Crystal.\n\nThis is heavily based on HTTP stdlib and inspiration from https://github.com/Ibsciss/ruby-middleware\n\n## Installation\n\nAdd this to your application's `shard.yml`:\n\n```yaml\ndependencies:\n  middleware:\n    github: russ/middleware\n```\n\n## Usage\n\n```crystal\nrequire \"middleware\"\n```\n\n```\nclass PushHandler\n  include Middleware::Handler\n\n  def initialize(@to_add : String)\n  end\n\n  def call(env : EnvType)\n    env[\"result\"] << @to_add\n    call_next(env)\n  end\nend\n\ncontext = { \"result\" => [] of String }\ninstance = Middleware::Builder.new([\n  PushHandler.new(\"foobar\"),\n  PushHandler.new(\"barfoo\")\n])\ninstance.call(context)\n```\n\n`{ \"result\" => [\"foobar\", \"barfoo\"] }`\n\n## Contributing\n\n1. Fork it ( https://github.com/russ/Middleware/fork )\n2. Create your feature branch (git checkout -b my-new-feature)\n3. Commit your changes (git commit -am 'Add some feature')\n4. Push to the branch (git push origin my-new-feature)\n5. Create a new Pull Request\n\n## Contributors\n\n- [russ](https://github.com/russ) Russ Smith - creator, maintainer\n","program":{"html_id":"github.com/russ/middleware/toplevel","path":"toplevel.html","kind":"module","full_name":"Top Level Namespace","name":"Top Level Namespace","abstract":false,"superclass":null,"ancestors":[],"locations":[],"repository_name":"github.com/russ/middleware","program":true,"enum":false,"alias":false,"aliased":"","const":false,"constants":[],"included_modules":[],"extended_modules":[],"subclasses":[],"including_types":[],"namespace":null,"doc":null,"summary":null,"class_methods":[],"constructors":[],"instance_methods":[],"macros":[],"types":[{"html_id":"github.com/russ/middleware/Middleware","path":"Middleware.html","kind":"module","full_name":"Middleware","name":"Middleware","abstract":false,"superclass":null,"ancestors":[],"locations":[{"filename":"middleware/builder.cr","line_number":1,"url":"https://github.com/russ/middleware/blob/927b6ea15abeff847982034b3de7909ec131e908/src/middleware/builder.cr"},{"filename":"middleware/handler.cr","line_number":1,"url":"https://github.com/russ/middleware/blob/927b6ea15abeff847982034b3de7909ec131e908/src/middleware/handler.cr"},{"filename":"middleware/version.cr","line_number":1,"url":"https://github.com/russ/middleware/blob/927b6ea15abeff847982034b3de7909ec131e908/src/middleware/version.cr"},{"filename":"middleware.cr","line_number":3,"url":"https://github.com/russ/middleware/blob/927b6ea15abeff847982034b3de7909ec131e908/src/middleware.cr"}],"repository_name":"github.com/russ/middleware","program":false,"enum":false,"alias":false,"aliased":"","const":false,"constants":[{"name":"VERSION","value":"\"0.1.0\"","doc":null,"summary":null}],"included_modules":[],"extended_modules":[],"subclasses":[],"including_types":[],"namespace":null,"doc":null,"summary":null,"class_methods":[],"constructors":[],"instance_methods":[],"macros":[],"types":[{"html_id":"github.com/russ/middleware/Middleware/Builder","path":"Middleware/Builder.html","kind":"class","full_name":"Middleware::Builder","name":"Builder","abstract":false,"superclass":{"html_id":"github.com/russ/middleware/Reference","kind":"class","full_name":"Reference","name":"Reference"},"ancestors":[{"html_id":"github.com/russ/middleware/Reference","kind":"class","full_name":"Reference","name":"Reference"},{"html_id":"github.com/russ/middleware/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[{"filename":"middleware/builder.cr","line_number":2,"url":"https://github.com/russ/middleware/blob/927b6ea15abeff847982034b3de7909ec131e908/src/middleware/builder.cr"}],"repository_name":"github.com/russ/middleware","program":false,"enum":false,"alias":false,"aliased":"","const":false,"constants":[],"included_modules":[],"extended_modules":[],"subclasses":[],"including_types":[],"namespace":{"html_id":"github.com/russ/middleware/Middleware","kind":"module","full_name":"Middleware","name":"Middleware"},"doc":null,"summary":null,"class_methods":[{"id":"build_call_chain(handlers)-class-method","html_id":"build_call_chain(handlers)-class-method","name":"build_call_chain","doc":null,"summary":null,"abstract":false,"args":[{"name":"handlers","doc":null,"default_value":"","external_name":"handlers","restriction":""}],"args_string":"(handlers)","source_link":"https://github.com/russ/middleware/blob/927b6ea15abeff847982034b3de7909ec131e908/src/middleware/builder.cr#L17","source_link":"https://github.com/russ/middleware/blob/927b6ea15abeff847982034b3de7909ec131e908/src/middleware/builder.cr#L17","def":{"name":"build_call_chain","args":[{"name":"handlers","doc":null,"default_value":"","external_name":"handlers","restriction":""}],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":"if handlers.empty?\n  raise(ArgumentError.new(\"You must specify at least one handler.\"))\nend\n0.upto(handlers.size - 2) do |i|\n  handlers[i].next = handlers[i + 1]\nend\nhandlers.first\n"}}],"constructors":[{"id":"new(handlers:Array(Handler))-class-method","html_id":"new(handlers:Array(Handler))-class-method","name":"new","doc":"Creates a new builder with the *handlers* array as handler chain.","summary":"<p>Creates a new builder with the <em>handlers</em> array as handler chain.</p>","abstract":false,"args":[{"name":"handlers","doc":null,"default_value":"","external_name":"handlers","restriction":"Array(Handler)"}],"args_string":"(handlers : Array(Handler))","source_link":"https://github.com/russ/middleware/blob/927b6ea15abeff847982034b3de7909ec131e908/src/middleware/builder.cr#L6","source_link":"https://github.com/russ/middleware/blob/927b6ea15abeff847982034b3de7909ec131e908/src/middleware/builder.cr#L6","def":{"name":"new","args":[{"name":"handlers","doc":null,"default_value":"","external_name":"handlers","restriction":"Array(Handler)"}],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":"new(Middleware::Builder.build_call_chain(handlers))"}},{"id":"new(handler:Handler)-class-method","html_id":"new(handler:Handler)-class-method","name":"new","doc":null,"summary":null,"abstract":false,"args":[{"name":"handler","doc":null,"default_value":"","external_name":"handler","restriction":"Handler"}],"args_string":"(handler : Handler)","source_link":"https://github.com/russ/middleware/blob/927b6ea15abeff847982034b3de7909ec131e908/src/middleware/builder.cr#L10","source_link":"https://github.com/russ/middleware/blob/927b6ea15abeff847982034b3de7909ec131e908/src/middleware/builder.cr#L10","def":{"name":"new","args":[{"name":"handler","doc":null,"default_value":"","external_name":"handler","restriction":"Handler"}],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":"_ = allocate\n_.initialize(handler)\nif _.responds_to?(:finalize)\n  ::GC.add_finalizer(_)\nend\n_\n"}}],"instance_methods":[{"id":"call(env=Nil)-instance-method","html_id":"call(env=Nil)-instance-method","name":"call","doc":null,"summary":null,"abstract":false,"args":[{"name":"env","doc":null,"default_value":"Nil","external_name":"env","restriction":""}],"args_string":"(env = <span class=\"t\">Nil</span>)","source_link":"https://github.com/russ/middleware/blob/927b6ea15abeff847982034b3de7909ec131e908/src/middleware/builder.cr#L13","source_link":"https://github.com/russ/middleware/blob/927b6ea15abeff847982034b3de7909ec131e908/src/middleware/builder.cr#L13","def":{"name":"call","args":[{"name":"env","doc":null,"default_value":"Nil","external_name":"env","restriction":""}],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":"@handler.call(env)"}}],"macros":[],"types":[]},{"html_id":"github.com/russ/middleware/Middleware/Handler","path":"Middleware/Handler.html","kind":"module","full_name":"Middleware::Handler","name":"Handler","abstract":false,"superclass":null,"ancestors":[],"locations":[{"filename":"middleware/handler.cr","line_number":2,"url":"https://github.com/russ/middleware/blob/927b6ea15abeff847982034b3de7909ec131e908/src/middleware/handler.cr"}],"repository_name":"github.com/russ/middleware","program":false,"enum":false,"alias":false,"aliased":"","const":false,"constants":[],"included_modules":[],"extended_modules":[],"subclasses":[],"including_types":[],"namespace":{"html_id":"github.com/russ/middleware/Middleware","kind":"module","full_name":"Middleware","name":"Middleware"},"doc":null,"summary":null,"class_methods":[],"constructors":[],"instance_methods":[{"id":"call(env)-instance-method","html_id":"call(env)-instance-method","name":"call","doc":null,"summary":null,"abstract":true,"args":[{"name":"env","doc":null,"default_value":"","external_name":"env","restriction":""}],"args_string":"(env)","source_link":"https://github.com/russ/middleware/blob/927b6ea15abeff847982034b3de7909ec131e908/src/middleware/handler.cr#L5","source_link":"https://github.com/russ/middleware/blob/927b6ea15abeff847982034b3de7909ec131e908/src/middleware/handler.cr#L5","def":{"name":"call","args":[{"name":"env","doc":null,"default_value":"","external_name":"env","restriction":""}],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":""}},{"id":"call_next(env)-instance-method","html_id":"call_next(env)-instance-method","name":"call_next","doc":null,"summary":null,"abstract":false,"args":[{"name":"env","doc":null,"default_value":"","external_name":"env","restriction":""}],"args_string":"(env)","source_link":"https://github.com/russ/middleware/blob/927b6ea15abeff847982034b3de7909ec131e908/src/middleware/handler.cr#L7","source_link":"https://github.com/russ/middleware/blob/927b6ea15abeff847982034b3de7909ec131e908/src/middleware/handler.cr#L7","def":{"name":"call_next","args":[{"name":"env","doc":null,"default_value":"","external_name":"env","restriction":""}],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":"if next_handler = @next\n  next_handler.call(env)\nelse\n  env\nend"}},{"id":"next:Handler?-instance-method","html_id":"next:Handler?-instance-method","name":"next","doc":null,"summary":null,"abstract":false,"args":[],"args_string":" : Handler?","source_link":"https://github.com/russ/middleware/blob/927b6ea15abeff847982034b3de7909ec131e908/src/middleware/handler.cr#L3","source_link":"https://github.com/russ/middleware/blob/927b6ea15abeff847982034b3de7909ec131e908/src/middleware/handler.cr#L3","def":{"name":"next","args":[],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"Handler | Nil","visibility":"Public","body":"@next"}},{"id":"next=(next:Handler?)-instance-method","html_id":"next=(next:Handler?)-instance-method","name":"next=","doc":null,"summary":null,"abstract":false,"args":[{"name":"next","doc":null,"default_value":"","external_name":"next","restriction":"Handler | Nil"}],"args_string":"(next : Handler?)","source_link":"https://github.com/russ/middleware/blob/927b6ea15abeff847982034b3de7909ec131e908/src/middleware/handler.cr#L3","source_link":"https://github.com/russ/middleware/blob/927b6ea15abeff847982034b3de7909ec131e908/src/middleware/handler.cr#L3","def":{"name":"next=","args":[{"name":"next","doc":null,"default_value":"","external_name":"next","restriction":"Handler | Nil"}],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":"@next = next"}}],"macros":[],"types":[]}]}]}}